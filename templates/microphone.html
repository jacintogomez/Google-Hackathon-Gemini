<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ language }} Chat</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles.css') }}">
    <style>
        body{
            display: flex;
            flex-wrap: wrap;
            text-align: center;
            justify-content: center;
            align-items: center;
            width: 100vw;
            background: radial-gradient(circle,#ffffff,#bfbfbf);
            color: black;
        }
        button{
            background-color: greenyellow;
            height: 50px;
            width: 200px;
            border-radius: 25px;
            border: 5px solid black;
            margin: 5px;
        }
        .split-left{
            display: flex;
            flex-direction: column;
            flex: 3;
            justify-content: space-around;
            height: 100vh;
        }
        .split-right{
            display: flex;
            flex-direction: column;
            flex: 2;
            justify-content: space-around;
            height: 100vh;
        }
        .mic{
            background-color: tan;
            height: 100px;
            width: 100px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 5px solid black;
            margin: 0 auto;
        }
        .response{
            flex: 1;
            width: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }
        #machine{
            animation: none;
            animation-name: none;
        }
        #human{
            animation: none;
            animation-name: none;
        }
        #cursor{
            display: inline-block;
            width: 2px;
            height: 1em;
            animation: blink-caret 0.75s infinite;
        }
        @keyframes mach{
            from{transform: translateY(0);}
            50%{transform: translateY(-250px);}
            to{transform: translateY(0);}
        }
        @keyframes hum{
            from{transform: translateY(0);}
            50%{transform: translateY(250px);}
            to{transform: translateY(0);}
        }
        @keyframes blink-caret{
            50%{opacity: 0;}
        }
    </style>
</head>
<body>
    <div class="split-left" style="border: 1px solid #cccccc;">
        <div id="machine" class="response">machine text is displayed here</div>
        <div id="human" class="response">human text is displayed here</div>
    </div>
    <div class="split-right" style="border: 1px solid #cccccc;">
        <div id="mic" class="mic">Begin</div>
        <div>
            <form id="human_form">
                <button type="submit">Record</button>
            </form>
            <form id="stop">
                <button id="stop" class="stop" type="submit">Stop Session</button>
            </form>
        </div>
        <a href="/static/trans.txt" download>
            <button>
                Download Transcript
            </button>
        </a>
    </div>
    <script>
        let mt=document.getElementById('machine');
        let ht=document.getElementById('human');
        document.querySelector('#human_form').addEventListener('submit',async function(e){
            e.preventDefault();
            try{
                const formdata=new FormData(this);
                const humres=await fetch('/process_human',{
                    method:'POST',
                    body:formdata
                });
                if(!humres.ok){
                    throw new Error('Server error: '+humres.status);
                }
                const humtx=await humres.json();
                typedisplay(humtx.human_response,ht);

                const machres=await fetch('/process_machine',{
                    method:'POST',
                    body:formdata
                });
                if(!machres.ok){
                    throw new Error('Server error: '+machres.status);
                }
                const machtx=await machres.json();
                typedisplay(machtx.machine_response,mt);
                fetch('/machine_speak')
            }catch(error){
                alert('Sorry, an error occurred: '+error.message);
            }
        });
        document.querySelector('#stop').addEventListener('submit',async function(){
            fetch('/stop_session');
        });
        function typedisplay(msg,element){
            element.textContent='';
            let i=0;
            const interval=setInterval(()=>{
                if(i<msg.length){
                    element.textContent+=msg[i];
                    i++;
                }else{
                    clearInterval(interval);
                }
            },10);
        }
    </script>
</body>
</html>